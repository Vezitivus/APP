<!doctype html>
<html lang="lv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Skvoša turnīrs (vienkārši)</title>
  <style>
    :root{
      --bg:#0b0f14;
      --card:#111826;
      --text:#e8eef7;
      --muted:#9fb0c4;
      --line:#223049;
      --accent:#60a5fa;
      --good:#2dd4bf;
      --bad:#fb7185;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(900px 500px at 20% -20%, rgba(96,165,250,.22), transparent 60%),
                  radial-gradient(800px 500px at 90% 10%, rgba(45,212,191,.14), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{max-width:900px;margin:0 auto;padding:18px}
    .top{
      display:flex; gap:10px; justify-content:space-between; align-items:center; flex-wrap:wrap;
      padding:14px 14px; border:1px solid var(--line); border-radius: var(--radius);
      background: rgba(17,24,38,.75); box-shadow: var(--shadow);
    }
    .title{font-weight:900}
    .muted{color:var(--muted); font-size:12px}
    .btn{
      border:1px solid var(--line);
      background: rgba(17,24,38,.85);
      color:var(--text);
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:750;
    }
    .btn:hover{border-color:rgba(96,165,250,.55)}
    .btn.primary{background: rgba(96,165,250,.18); border-color: rgba(96,165,250,.35)}
    .btn.good{background: rgba(45,212,191,.14); border-color: rgba(45,212,191,.35)}
    .btn.bad{background: rgba(251,113,133,.14); border-color: rgba(251,113,133,.35)}
    .grid{margin-top:14px; display:grid; grid-template-columns: 1fr; gap:14px}
    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(17,24,38,.72);
      box-shadow: var(--shadow);
      padding:14px;
    }
    h2{margin:0 0 10px 0; font-size:16px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:end}
    .field{display:grid; gap:6px; flex:1 1 240px}
    label{font-size:12px; color:var(--muted)}
    input{
      width:100%;
      padding:10px 11px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(15,22,34,.9);
      color: var(--text);
      outline:none;
    }
    input:focus{border-color: rgba(96,165,250,.55)}
    .list{display:grid; gap:8px}
    .item{
      border:1px solid var(--line);
      border-radius: 12px;
      background: rgba(15,22,34,.75);
      padding:10px;
      display:flex; justify-content:space-between; gap:10px; align-items:center;
    }
    .item b{font-weight:900}
    .hr{height:1px;background:var(--line); margin:12px 0}
    .note{
      border:1px dashed rgba(96,165,250,.45);
      background: rgba(96,165,250,.08);
      border-radius: 12px;
      padding:10px 12px;
      color: var(--muted);
      font-size: 13px;
    }
    .pairs{
      border:1px solid var(--line);
      border-radius: 12px;
      overflow:hidden;
    }
    table{width:100%; border-collapse:collapse}
    th, td{padding:10px; border-bottom:1px solid rgba(34,48,73,.7); text-align:left; font-size:13px}
    th{color:var(--muted); background: rgba(17,24,38,.35)}
    tr:last-child td{border-bottom:none}
    @media (max-width: 600px){
      .row{align-items:stretch}
      .btn{width:100%}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="title">Skvoša turnīrs</div>
        <div class="muted">Vienkārši: nosaukums → spēlētāji → ģenerēt spēles. Viss glabājas ierīcē.</div>
      </div>
      <div class="row">
        <button class="btn bad" id="btnReset">Notīrīt visu</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Turnīrs</h2>
        <div class="row">
          <div class="field">
            <label>Turnīra nosaukums</label>
            <input id="tName" type="text" />
          </div>
          <button class="btn primary" id="btnSaveName">Saglabāt</button>
        </div>
        <div class="hr"></div>
        <div class="note" id="statusBox"></div>
      </div>

      <div class="card">
        <h2>Spēlētāji</h2>
        <div class="row">
          <div class="field">
            <label>Spēlētāja vārds</label>
            <input id="pName" type="text" />
          </div>
          <button class="btn good" id="btnAddPlayer">Pievienot</button>
        </div>
        <div class="hr"></div>
        <div class="list" id="playersList"></div>
        <div class="hr"></div>
        <div class="row">
          <button class="btn primary" id="btnGenerate">Ģenerēt spēles</button>
          <button class="btn bad" id="btnClearMatches">Dzēst spēles</button>
        </div>
      </div>

      <div class="card">
        <h2>Spēles (katrs ar katru)</h2>
        <div id="matchesBox"></div>
      </div>
    </div>
  </div>

<script>
(() => {
  "use strict";

  const KEY = "squash_simple_v1";

  const $ = (s) => document.querySelector(s);
  const uid = () => crypto.randomUUID ? crypto.randomUUID() : ("id_" + Math.random().toString(16).slice(2) + Date.now());

  function load(){
    const raw = localStorage.getItem(KEY);
    if(!raw){
      return { tournamentName: "", players: [], matches: [] };
    }
    try{
      const obj = JSON.parse(raw);
      obj.tournamentName ??= "";
      obj.players ??= [];
      obj.matches ??= [];
      return obj;
    }catch{
      return { tournamentName: "", players: [], matches: [] };
    }
  }

  function save(){
    localStorage.setItem(KEY, JSON.stringify(state));
  }

  let state = load();

  function setStatus(){
    const nameOk = state.tournamentName.trim().length > 0;
    const pCount = state.players.length;
    const mCount = state.matches.length;

    const steps = [];
    steps.push(nameOk ? "✅ Turnīra nosaukums saglabāts." : "1) Ievadi turnīra nosaukumu un nospied “Saglabāt”.");
    steps.push(pCount >= 2 ? `✅ Spēlētāji pievienoti: ${pCount}.` : "2) Pievieno vismaz 2 spēlētājus.");
    steps.push(mCount > 0 ? `✅ Spēles ģenerētas: ${mCount}.` : "3) Spied “Ģenerēt spēles”, lai automātiski sadalītu pārus.");

    $("#statusBox").textContent = steps.join(" ");
  }

  function renderPlayers(){
    const box = $("#playersList");
    box.innerHTML = "";

    if(state.players.length === 0){
      box.appendChild(document.createTextNode("Nav spēlētāju."));
      box.classList.add("muted");
      return;
    }
    box.classList.remove("muted");

    for(const p of state.players){
      const row = document.createElement("div");
      row.className = "item";
      row.innerHTML = `<b>${escapeHtml(p.name)}</b>`;
      const del = document.createElement("button");
      del.className = "btn bad";
      del.textContent = "Dzēst";
      del.onclick = () => {
        // neļaujam dzēst, ja spēles jau ģenerētas
        const used = state.matches.some(m => m.aId === p.id || m.bId === p.id);
        if(used){
          alert("Spēlētāju nevar dzēst, kamēr ir ģenerētas spēles. Dzēs spēles un tad dzēs spēlētāju.");
          return;
        }
        state.players = state.players.filter(x => x.id !== p.id);
        save();
        renderAll();
      };
      row.appendChild(del);
      box.appendChild(row);
    }
  }

  function renderMatches(){
    const box = $("#matchesBox");
    box.innerHTML = "";

    if(state.matches.length === 0){
      box.appendChild(document.createTextNode("Nav spēļu. Nospied “Ģenerēt spēles”."));
      box.classList.add("muted");
      return;
    }
    box.classList.remove("muted");

    const tableWrap = document.createElement("div");
    tableWrap.className = "pairs";

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    thead.innerHTML = `<tr><th>#</th><th>Spēlētājs A</th><th>Spēlētājs B</th></tr>`;
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    state.matches.forEach((m, idx) => {
      const a = state.players.find(p => p.id === m.aId)?.name || "?";
      const b = state.players.find(p => p.id === m.bId)?.name || "?";
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${idx+1}</td><td>${escapeHtml(a)}</td><td>${escapeHtml(b)}</td>`;
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);

    tableWrap.appendChild(table);
    box.appendChild(tableWrap);
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function generateRoundRobin(){
    if(state.players.length < 2){
      alert("Vajag vismaz 2 spēlētājus.");
      return;
    }
    if(!state.tournamentName.trim()){
      alert("Ievadi un saglabā turnīra nosaukumu.");
      return;
    }

    const pairs = [];
    for(let i=0;i<state.players.length;i++){
      for(let j=i+1;j<state.players.length;j++){
        pairs.push({ aId: state.players[i].id, bId: state.players[j].id });
      }
    }
    state.matches = pairs;
    save();
    renderAll();
  }

  function clearMatches(){
    if(state.matches.length === 0) return;
    if(!confirm("Dzēst visas spēles?")) return;
    state.matches = [];
    save();
    renderAll();
  }

  function renderAll(){
    $("#tName").value = state.tournamentName || "";
    renderPlayers();
    renderMatches();
    setStatus();
  }

  // Events
  $("#btnSaveName").onclick = () => {
    state.tournamentName = $("#tName").value.trim();
    save();
    renderAll();
  };

  $("#btnAddPlayer").onclick = () => {
    const name = $("#pName").value.trim();
    if(!name){ alert("Ievadi spēlētāja vārdu."); return; }
    state.players.push({ id: uid(), name });
    $("#pName").value = "";
    save();
    renderAll();
  };

  $("#btnGenerate").onclick = () => {
    if(state.matches.length > 0){
      if(!confirm("Spēles jau ir ģenerētas. Pārgenerēt no jauna?")) return;
    }
    generateRoundRobin();
  };

  $("#btnClearMatches").onclick = clearMatches;

  $("#btnReset").onclick = () => {
    if(!confirm("Notīrīt visu (turnīru, spēlētājus, spēles) no šīs ierīces?")) return;
    localStorage.removeItem(KEY);
    state = load();
    renderAll();
  };

  // Enter key shortcuts
  $("#tName").addEventListener("keydown", (e) => { if(e.key === "Enter") $("#btnSaveName").click(); });
  $("#pName").addEventListener("keydown", (e) => { if(e.key === "Enter") $("#btnAddPlayer").click(); });

  // Boot
  renderAll();
})();
</script>
</body>
</html>