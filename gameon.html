<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GameOn Tournament</title>
  <style>
    /* Pamatstils */
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    h1 {
      font-size: 2.5em;
      color: #0056b3;
    }
    main {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    section {
      margin-bottom: 30px;
    }
    h2 {
      color: #0056b3;
    }
    textarea {
      width: 100%;
      padding: 10px;
      font-size: 1em;
      border-radius: 4px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    button {
      background: #0056b3;
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #004494;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    th {
      background: #e6f0ff;
    }
    pre {
      background: #f4f4f4;
      padding: 10px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <header>
    <h1>GameOn Tournament Generator</h1>
  </header>
  <main>
    <!-- Komandu ievades sadaļa -->
    <section id="inputSection">
      <h2>Ievadi komandas</h2>
      <p>Ievadi katru komandu jaunā rindā:</p>
      <form id="teamForm">
         <textarea id="teamsInput" rows="8" placeholder="Piemēram: 
Team A
Team B
Team C"></textarea>
         <br>
         <button type="submit">Saglabāt komandas</button>
      </form>
    </section>
    
    <!-- Poga izvēlei -->
    <section id="buttonsSection" style="display:none;">
       <h2>Turnīra sadaļas</h2>
       <button id="groupAButton">Group A</button>
       <button id="groupBButton">Group B</button>
       <button id="standingsButton">Standings</button>
       <button id="playoffsButton">Playoffs</button>
    </section>
    
    <!-- Rezultātu attēlošanas sadaļa -->
    <section id="resultSection" style="display:none;">
      <h2>Rezultāti</h2>
      <div id="resultContainer"></div>
    </section>
  </main>
  
  <script>
    // Google Apps Script webapp URL (back-end)
    const scriptUrl = "https://script.google.com/macros/s/AKfycbzfBFIGVe5RhJh5Kgucv2K3ms2MIUMAd2haR6-WCqUkDEt6KJZMmootY5_R3FP9QSssZA/exec";

    // Saglabā komandu sarakstu Google Sheets
    document.getElementById("teamForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const teamsText = document.getElementById("teamsInput").value;
      const teamsArray = teamsText.split("\n").map(t => t.trim()).filter(t => t !== "");
      if(teamsArray.length === 0) {
         alert("Lūdzu ievadi vismaz vienu komandu!");
         return;
      }
      
      // Nosūtām komandu sarakstu kā JSON
      const params = new URLSearchParams();
      params.append("action", "saveTeams");
      params.append("teams", JSON.stringify(teamsArray));
      
      fetch(scriptUrl + "?" + params.toString())
      .then(response => response.json())
      .then(data => {
         console.log("Komandas saglabātas:", data);
         alert("Komandas veiksmīgi saglabātas!");
         document.getElementById("inputSection").style.display = "none";
         document.getElementById("buttonsSection").style.display = "block";
      })
      .catch(error => {
         console.error("Kļūda saglabājot komandas:", error);
         alert("Kļūda saglabājot komandas");
      });
    });
    
    // Funkcija datu izgūšanai atkarībā no izvēlētās sadaļas
    function fetchData(action) {
       const params = new URLSearchParams();
       params.append("action", action);
       fetch(scriptUrl + "?" + params.toString())
       .then(response => response.json())
       .then(data => {
         displayData(action, data);
       })
       .catch(error => {
         console.error("Kļūda izgūstot datus:", error);
         alert("Kļūda izgūstot datus par: " + action);
       });
    }
    
    // Datu attēlošana HTML formātā
    function displayData(action, data) {
      const resultContainer = document.getElementById("resultContainer");
      resultContainer.innerHTML = "";
      
      if(action === "groupA" || action === "groupB") {
         let html = `<h3>${action === "groupA" ? "Group A" : "Group B"}</h3>`;
         if(Array.isArray(data)) {
            html += "<ul>";
            data.forEach(item => {
              html += `<li>${item}</li>`;
            });
            html += "</ul>";
         } else {
            html += "<p>Nekas nav atrasts.</p>";
         }
         resultContainer.innerHTML = html;
      } else if(action === "standings") {
         let html = "<h3>Standings</h3>";
         if(Array.isArray(data)) {
           html += "<table><tr><th>Team</th><th>Games</th><th>Wins</th><th>Losses</th><th>Points Won</th><th>Points Lost</th></tr>";
           data.forEach(row => {
             html += `<tr>
                        <td>${row.team}</td>
                        <td>${row.games}</td>
                        <td>${row.wins}</td>
                        <td>${row.losses}</td>
                        <td>${row.pointsWon}</td>
                        <td>${row.pointsLost}</td>
                      </tr>`;
           });
           html += "</table>";
         } else {
           html += "<p>Nekas nav atrasts.</p>";
         }
         resultContainer.innerHTML = html;
      } else if(action === "playoffs") {
         let html = "<h3>Playoffs</h3>";
         if(data && typeof data === "object") {
            // Šeit var pielāgot atbilstoši saņemtajam struktūras formātam – šeit vienkārši izvadām JSON
            html += "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
         } else {
            html += "<p>Nekas nav atrasts.</p>";
         }
         resultContainer.innerHTML = html;
      }
      
      document.getElementById("resultSection").style.display = "block";
    }
    
    // Notikumu klausītāji pogām
    document.getElementById("groupAButton").addEventListener("click", function(){
       fetchData("groupA");
    });
    document.getElementById("groupBButton").addEventListener("click", function(){
       fetchData("groupB");
    });
    document.getElementById("standingsButton").addEventListener("click", function(){
       fetchData("standings");
    });
    document.getElementById("playoffsButton").addEventListener("click", function(){
       fetchData("playoffs");
    });
  </script>
</body>
</html>
