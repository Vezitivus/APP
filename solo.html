<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SOLO GAMES</title>
  <style>
    /* (tavs stils šeit – kā iepriekš) */
  </style>
</head>
<body>
  <div class="container">
    <h1>SOLO GAMES</h1>
    <div class="row">
      <select id="gameSelect" disabled>
        <option>Ļauj ielādēt…</option>
      </select>
    </div>
    <div id="playersGrid" class="players-grid hidden">
      <div class="player-column">
        <select id="player1"><option>Spēlētājs 1</option></select>
        <input type="number" id="score1" placeholder="Punkti" min="0" disabled>
      </div>
      <div class="player-column">
        <select id="player2"><option>Spēlētājs 2</option></select>
        <input type="number" id="score2" placeholder="Punkti" min="0" disabled>
      </div>
    </div>
    <button id="submitBtn" class="hidden" disabled>Nosūtīt rezultātus</button>
  </div>

  <script>
    const gameSelect  = document.getElementById('gameSelect');
    const playersGrid = document.getElementById('playersGrid');
    const player1     = document.getElementById('player1');
    const player2     = document.getElementById('player2');
    const score1      = document.getElementById('score1');
    const score2      = document.getElementById('score2');
    const submitBtn   = document.getElementById('submitBtn');

    window.onload = () => {
      google.script.run
        .withSuccessHandler(headers => {
          gameSelect.innerHTML = '<option value="" disabled selected>Izvēlies spēli</option>';
          headers.forEach(name => {
            const o = document.createElement('option');
            o.value = o.textContent = name;
            gameSelect.appendChild(o);
          });
          gameSelect.disabled = false;
        })
        .getHeaders();
    };

    gameSelect.onchange = () => {
      google.script.run
        .withSuccessHandler(players => {
          [player1, player2].forEach(sel => {
            sel.innerHTML = '<option value="" disabled selected>Spēlētājs</option>';
            players.forEach(p => sel.appendChild(new Option(p, p)));
            sel.disabled = false;
          });
          score1.value = score2.value = '';
          score1.disabled = score2.disabled = true;
          submitBtn.disabled = true;
          submitBtn.classList.add('hidden');
          playersGrid.classList.remove('hidden');
        })
        .getPlayers(gameSelect.value);
    };

    function checkPlayers() {
      if (player1.value && player2.value && player1.value !== player2.value) {
        score1.disabled = score2.disabled = false;
      } else {
        score1.disabled = score2.disabled = true;
        submitBtn.disabled = true;
        submitBtn.classList.add('hidden');
      }
    }
    player1.onchange = player2.onchange = checkPlayers;

    function checkScores() {
      if (score1.value !== '' && score2.value !== '') {
        submitBtn.disabled = false;
        submitBtn.classList.remove('hidden');
      } else {
        submitBtn.disabled = true;
        submitBtn.classList.add('hidden');
      }
    }
    score1.oninput = score2.oninput = checkScores;

    submitBtn.onclick = () => {
      const s1 = +score1.value, s2 = +score2.value;
      google.script.run
        .withSuccessHandler(resp => {
          if (resp.status === 'success') {
            alert('Rezultāti saglabāti!');
            score1.value = score2.value = '';
            submitBtn.disabled = true;
            submitBtn.classList.add('hidden');
          } else {
            alert('Kļūda: ' + resp.message);
          }
        })
        .submitResult(
          gameSelect.value,
          s1 > s2 ? player1.value : player2.value,
          s1 > s2 ? player2.value : player1.value,
          Math.max(s1, s2),
          Math.min(s1, s2)
        );
    };
  </script>
</body>
</html>
