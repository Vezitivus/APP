<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VEZITIVUS - Bez CORS</title>
    <style>
      body {
        margin: 0; padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
        background: #f0f0f5;
      }
      header {
        position: fixed; top: 0; left: 0; right: 0; height: 60px;
        background: rgba(0,0,0,0.1); backdrop-filter: blur(8px);
        display: flex; align-items: center; justify-content: center;
        font-size: 24px; font-weight: bold;
        z-index: 1000;
      }
      main {
        margin-top: 80px; padding: 20px;
      }
      select, input {
        padding: 8px; font-size: 16px; border-radius: 8px; width: 100%;
        border: 1px solid #ccc; box-sizing: border-box;
      }
      button {
        padding: 10px 20px; font-size: 16px; border: none; border-radius: 8px;
        background: #007aff; color: #fff; cursor: pointer;
      }
      .players-container {
        display: flex; flex-wrap: wrap; gap: 10px;
      }
      .player {
        background: #fff; border: 1px solid #ccc; border-radius: 8px;
        padding: 10px; width: 120px; text-align: center;
      }
    </style>
  </head>
  <body>
    <header>VEZITIVUS GAME HOST</header>
    <main>
      <div>
        <h3>Aktivitātes (no F4:AP4)</h3>
        <div id="activitiesContainer"></div>
      </div>
      <hr>
      <div>
        <h3>Spēlētāji (no B6:B1000, C6:C1000)</h3>
        <div class="players-container" id="playersContainer"></div>
      </div>
      <hr>
      <div>
        <h3>Saglabāšanas piemērs:</h3>
        <div>
          <input type="text" id="inputUID" placeholder="UID">
          <input type="text" id="inputActivity" placeholder="Aktivitātes nosaukums">
          <input type="number" id="inputScore" placeholder="Punkti">
          <button onclick="saveData()">Saglabāt</button>
        </div>
        <div id="saveResultMsg" style="margin-top:10px;color:green;"></div>
      </div>
    </main>
    
    <!--
      Tālāk JavaScript koda daļa.
      Tagad varam lietot “templating”: 
      var activities = <?= JSON.stringify(activities) ?>;
      var players = <?= JSON.stringify(players) ?>;
    -->
    <script>
      // Ieliekam datus tieši iekš mainīgajiem – BEZ fetch!
      var activities = <?= JSON.stringify(this.activities) ?>;
      var players = <?= JSON.stringify(this.players) ?>;
      
      window.addEventListener('load', () => {
        // Parādām aktivitātes
        const actContainer = document.getElementById('activitiesContainer');
        if (activities.length === 0) {
          actContainer.textContent = "Nav atrastas aktivitātes.";
        } else {
          let html = "<ul>";
          activities.forEach(a => {
            html += "<li>" + a + "</li>";
          });
          html += "</ul>";
          actContainer.innerHTML = html;
        }
        
        // Parādām spēlētājus
        const plContainer = document.getElementById('playersContainer');
        if (players.length === 0) {
          plContainer.textContent = "Nav atrasti spēlētāji.";
        } else {
          players.forEach(p => {
            const div = document.createElement('div');
            div.className = "player";
            div.innerHTML = "<strong>" + p.uid + "</strong><br>" + p.name;
            plContainer.appendChild(div);
          });
        }
      });
      
      // Piemērs, kā saglabāt datus, izmantojot google.script.run
      function saveData() {
        const uid = document.getElementById('inputUID').value;
        const activity = document.getElementById('inputActivity').value;
        const score = document.getElementById('inputScore').value;
        
        document.getElementById('saveResultMsg').textContent = "Saglabāju...";
        
        // google.script.run izsauc servera pusi (Code.gs: saveScore)
        google.script.run
          .withSuccessHandler(function(response) {
            document.getElementById('saveResultMsg').textContent = "Atbilde: " + response;
          })
          .withFailureHandler(function(err) {
            document.getElementById('saveResultMsg').textContent = "Kļūda: " + err.message;
          })
          .saveScore(uid, activity, score);
      }
    </script>
  </body>
</html>
